<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>បញ្ជីឈ្មោះបុគ្គលិក (Staff List)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kantumruy Pro', sans-serif;
            background-color: #f8fafc; /* A lighter, cleaner background */
            overscroll-behavior-x: none; /* Prevents browser's back/forward swipe gesture */
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #a8a8a8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        .card-enter {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .card-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
        .pagination-btn {
            @apply flex items-center justify-center px-3 h-8 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400 dark:hover:bg-slate-700 dark:hover:text-white;
        }
        .pagination-btn.active {
             @apply z-10 text-blue-600 border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-slate-500 dark:bg-slate-700 dark:text-white;
        }
        .pagination-btn.disabled {
            @apply opacity-50 cursor-not-allowed;
        }

    </style>
</head>
<body class="dark:bg-slate-900 text-slate-800 dark:text-slate-200 min-h-screen">

    <!-- Initial Loading Overlay -->
    <div id="initial-loading-overlay" class="fixed inset-0 bg-slate-100 dark:bg-slate-900 flex flex-col justify-center items-center z-50 transition-opacity duration-700">
        <img src="https://i.postimg.cc/rwznn9Zh/photo-2025-05-01-09-50-00.jpg" alt="Company Logo" class="w-32 h-32 rounded-full mb-6 animate-pulse shadow-lg">
        <div class="flex items-center text-slate-700 dark:text-slate-200 text-lg">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>ប្រព័ន្ធកំពុងដំណើការសូមរង់ចាំបន្តិច....!</span>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-6">
        <!-- Header -->
        <header class="text-center mb-6 md:mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white flex items-center justify-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <span>បញ្ជីឈ្មោះបុគ្គលិក</span>
            </h1>
            <h2 class="text-xl md:text-2xl font-medium text-slate-700 dark:text-slate-300 mt-2">ឧស្សាហកម្មឌីជីថល</h2>
        </header>

        <!-- Filter and Search Controls -->
        <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 rounded-xl shadow-lg mb-6 sticky top-4 z-10 border dark:border-slate-700">
            <div class="space-y-4">
                <!-- Search and Mobile Filter Button Wrapper -->
                <div class="flex gap-4 items-end">
                    <!-- Search Input -->
                    <div class="flex-grow">
                        <label for="searchInput" class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1">ស្វែងរក</label>
                        <input type="text" id="searchInput" placeholder="ឈ្មោះ, អត្តលេខ, ក្រុម, ថ្នាក់..." class="w-full px-3 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                    </div>
                    <!-- Mobile Filter Toggle Button -->
                    <button id="toggleFiltersBtn" class="md:hidden p-2 bg-slate-200 dark:bg-slate-700 rounded-lg flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
                    </button>
                </div>

                <!-- Collapsible Filter Area -->
                <div id="filtersWrapper" class="hidden md:grid md:grid-cols-1 lg:grid-cols-3 gap-4 pt-4 md:pt-0">
                    <!-- Group Filter -->
                    <div>
                        <label for="groupFilter" class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1">ក្រុម</label>
                        <select id="groupFilter" class="w-full px-3 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            <option value="">គ្រប់ក្រុម</option>
                        </select>
                    </div>
                    <!-- Class Filter -->
                    <div>
                        <label for="classFilter" class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1">ថ្នាក់</label>
                        <select id="classFilter" class="w-full px-3 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            <option value="">គ្រប់ថ្នាក់</option>
                        </select>
                    </div>
                    <!-- Section Filter -->
                    <div>
                        <label for="sectionFilter" class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1">ផ្នែកការងារ</label>
                        <select id="sectionFilter" class="w-full px-3 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            <option value="">គ្រប់ផ្នែក</option>
                        </select>
                    </div>
                </div>
            </div>

             <div class="flex flex-wrap gap-4 justify-between items-center mt-4">
                <div id="staffCount" class="text-sm text-slate-600 dark:text-slate-400"></div>
                <div class="flex items-center gap-3">
                    <button id="refreshButton" title="ផ្ទុកទិន្នន័យឡើងវិញ" class="group p-2 text-sm bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition dark:bg-slate-600 dark:text-slate-200 dark:hover:bg-slate-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-180"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                    </button>
                    <button id="resetButton" title="សម្អាតតម្រង" class="group p-2 text-sm bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition dark:bg-slate-600 dark:text-slate-200 dark:hover:bg-slate-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-[-15deg]"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/><path d="M22 21H7"/><path d="m5 12 5 5"/></svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Staff List Container -->
        <div id="staffList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5">
            <!-- Staff cards will be inserted here by JavaScript -->
        </div>

        <!-- Pagination Controls -->
        <div id="paginationControls" class="flex justify-center items-center space-x-1 sm:space-x-2 mt-8">
            <!-- Pagination buttons will be injected here -->
        </div>

        <!-- No Results Message -->
        <div id="noResults" class="hidden text-center py-10">
            <p class="text-slate-600 dark:text-slate-300 text-lg">មិនមានទិន្នន័យត្រូវគ្នានឹងការស្វែងរកទេ។</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4 mt-8 border-t dark:border-slate-700">
        <div id="summaryStats" class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2 text-sm text-slate-600 dark:text-slate-400 mb-3">
            <!-- Summary stats will be loaded here by JavaScript -->
        </div>
        <p class="text-sm text-slate-500 dark:text-slate-400 flex justify-center items-center gap-2">
            <span>អ្នកអភិវឌ្ឍកម្មវិធី IT SUPPORT |</span>
            <a href="https://darotrb0-bit.github.io/MMKITSUPPORTDI/" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline flex items-center gap-1">
                <span>MMKITSUPPORTDI Website</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            </a>
        </p>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const SHEET_ID = '1eRyPoifzyvB4oBmruNyXcoKMKPRqjk6xDD6-bPNW6pc';
        const SHEET_NAME = 'DIList';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

        // --- DOM ELEMENTS ---
        const searchInput = document.getElementById('searchInput');
        const groupFilter = document.getElementById('groupFilter');
        const classFilter = document.getElementById('classFilter');
        const sectionFilter = document.getElementById('sectionFilter');
        const staffListContainer = document.getElementById('staffList');
        const initialLoadingOverlay = document.getElementById('initial-loading-overlay');
        const noResultsMessage = document.getElementById('noResults');
        const staffCount = document.getElementById('staffCount');
        const resetButton = document.getElementById('resetButton');
        const refreshButton = document.getElementById('refreshButton');
        const paginationControls = document.getElementById('paginationControls');
        const toggleFiltersBtn = document.getElementById('toggleFiltersBtn');
        const filtersWrapper = document.getElementById('filtersWrapper');
        const summaryStats = document.getElementById('summaryStats');

        let allStaff = [];
        let filteredStaff = [];
        let currentPage = 1;
        let itemsPerPage = 40; // Default for desktop

        // --- DATA FETCHING AND PARSING ---
        async function fetchData() {
            // The loading overlay is visible by default via HTML/CSS
            staffListContainer.innerHTML = '';
            paginationControls.innerHTML = '';
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const csvText = await response.text();
                const rows = csvText.split('\n').slice(1);

                allStaff = rows.map(row => {
                    const columns = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                    const cleanCols = columns.map(col => col.trim().replace(/^"|"$/g, ''));

                    return {
                        id: cleanCols[4] || '',      // Column E
                        group: cleanCols[6] || '',   // Column G
                        name: cleanCols[11] || '',   // Column L
                        gender: cleanCols[13] || '', // Column N
                        class: cleanCols[17] || '',  // Column R
                        section: cleanCols[18] || '',// Column S
                        photoUrl: cleanCols[26] || ''// Column AA
                    };
                }).filter(staff => staff.id && staff.name);

                filteredStaff = [...allStaff];
                updateSummaryStats(filteredStaff); // Initial stats calculation
                populateFilters();
                updateItemsPerPage();
                displayPage(1);

            } catch (error) {
                console.error('Error fetching or parsing data:', error);
                staffListContainer.innerHTML = '<p class="text-center text-red-500">មានបញ្ហាក្នុងការទាញទិន្នន័យ។ សូមព្យាយាមម្តងទៀត។</p>';
            } finally {
                 if (initialLoadingOverlay) {
                    initialLoadingOverlay.classList.add('opacity-0');
                    // Remove the overlay from the DOM after the transition is complete
                    setTimeout(() => {
                        initialLoadingOverlay.style.display = 'none';
                    }, 700); // This should match the transition duration
                }
            }
        }
        
        // --- SUMMARY STATS ---
        function updateSummaryStats(staffArray) {
            const totalStaffCount = staffArray.length;
            // Assuming 'F' or 'ស្រី' in the gender column denotes female
            const femaleStaffCount = staffArray.filter(staff => staff.gender.toUpperCase() === 'F' || staff.gender === 'ស្រី').length; 
            
            if(summaryStats){
                summaryStats.innerHTML = `
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        <span class="font-semibold">បុគ្គលិកសរុប៖</span> ${totalStaffCount} នាក់
                    </div> 
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg>
                        <span class="font-semibold">បុគ្គលិកស្រី៖</span> ${femaleStaffCount} នាក់
                    </div>`;
            }
        }

        // --- PAGINATION & DISPLAY LOGIC ---
        function updateItemsPerPage() {
            if (window.innerWidth < 768) { // md breakpoint for Tailwind (mobile-first)
                itemsPerPage = 15; // 1 column x 15 rows
                staffListContainer.classList.remove('md:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
                staffListContainer.classList.add('grid-cols-1');
            } else {
                itemsPerPage = 40; // 4 columns x 10 rows
                staffListContainer.classList.add('md:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
                staffListContainer.classList.remove('grid-cols-1');
            }
        }
        
        function displayPage(page) {
            currentPage = page;
            staffListContainer.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = filteredStaff.slice(startIndex, endIndex);

            noResultsMessage.style.display = filteredStaff.length === 0 ? 'block' : 'none';
            staffCount.textContent = `លទ្ធផល៖ ${filteredStaff.length} នាក់`;

            paginatedItems.forEach((staff, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-slate-800 rounded-xl shadow-md hover:shadow-xl hover:scale-[1.03] p-4 transition-all duration-300 card-enter border border-slate-200 dark:border-slate-700';
                card.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 rounded-full flex-shrink-0 bg-slate-200 dark:bg-slate-700 border-4 border-slate-200 dark:border-slate-600 overflow-hidden">
                            <img 
                                src="${staff.photoUrl || `https://placehold.co/100x100/EBF4FF/333333?text=${staff.name.charAt(0)}`}" 
                                onerror="this.onerror=null; this.src='https://placehold.co/100x100/EBF4FF/333333?text=${staff.name.charAt(0)}'"
                                alt="រូបថតរបស់ ${staff.name}" 
                                class="w-full h-full object-cover"
                                loading="lazy"
                                decoding="async"
                            >
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-md sm:text-lg font-bold text-slate-900 dark:text-white truncate">${staff.name}</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400">អត្តលេខ: ${staff.id}</p>
                            <div class="mt-2 flex flex-wrap gap-x-2 gap-y-1">
                                ${staff.group ? `<span class="px-2 py-0.5 text-xs font-semibold text-green-800 bg-green-100 dark:bg-green-900 dark:text-green-200 rounded-full">${staff.group}</span>` : ''}
                                ${staff.class ? `<span class="px-2 py-0.5 text-xs font-semibold text-indigo-800 bg-indigo-100 dark:bg-indigo-900 dark:text-indigo-200 rounded-full">${staff.class}</span>` : ''}
                                ${staff.section ? `<span class="px-2 py-0.5 text-xs font-semibold text-purple-800 bg-purple-100 dark:bg-purple-900 dark:text-purple-200 rounded-full">${staff.section}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                staffListContainer.appendChild(card);
                setTimeout(() => card.classList.add('card-enter-active'), index * 25);
            });
            
            setupPagination();
        }

        function setupPagination() {
            paginationControls.innerHTML = '';
            const totalPages = Math.ceil(filteredStaff.length / itemsPerPage);

            if (totalPages <= 1) return;

            // Previous Button
            const prevButton = document.createElement('button');
            prevButton.innerHTML = `&laquo;`;
            prevButton.className = 'pagination-btn';
            if (currentPage === 1) prevButton.classList.add('disabled');
            prevButton.addEventListener('click', () => {
                if(currentPage > 1) displayPage(currentPage - 1);
            });
            paginationControls.appendChild(prevButton);

            // Page Buttons
            let pagesToShow = [];
            if (totalPages <= 5) {
                for (let i = 1; i <= totalPages; i++) pagesToShow.push(i);
            } else {
                if (currentPage <= 3) {
                    pagesToShow = [1, 2, 3, '...', totalPages];
                } else if (currentPage >= totalPages - 2) {
                    pagesToShow = [1, '...', totalPages - 2, totalPages - 1, totalPages];
                } else {
                    pagesToShow = [1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages];
                }
            }

            pagesToShow.forEach(page => {
                 if (page === '...') {
                    const dots = document.createElement('span');
                    dots.className = 'flex items-center justify-center px-3 h-8 text-sm font-medium text-gray-500 dark:text-slate-400';
                    dots.textContent = '...';
                    paginationControls.appendChild(dots);
                } else {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = page;
                    pageButton.className = 'pagination-btn';
                    if (page === currentPage) pageButton.classList.add('active');
                    pageButton.addEventListener('click', () => displayPage(page));
                    paginationControls.appendChild(pageButton);
                }
            });

            // Next Button
            const nextButton = document.createElement('button');
            nextButton.innerHTML = `&raquo;`;
            nextButton.className = 'pagination-btn';
            if (currentPage === totalPages) nextButton.classList.add('disabled');
            nextButton.addEventListener('click', () => {
                if(currentPage < totalPages) displayPage(currentPage + 1);
            });
            paginationControls.appendChild(nextButton);
        }

        // --- FILTERING LOGIC ---
        function populateFilters() {
            const groups = [...new Set(allStaff.map(s => s.group).filter(Boolean))].sort();
            const classes = [...new Set(allStaff.map(s => s.class).filter(Boolean))].sort();
            const sections = [...new Set(allStaff.map(s => s.section).filter(Boolean))].sort();

            populateSelect(groupFilter, groups);
            populateSelect(classFilter, classes);
            populateSelect(sectionFilter, sections);
        }

        function populateSelect(selectElement, options) {
            // Clear previous options except the first one
            while (selectElement.options.length > 1) {
                selectElement.remove(1);
            }
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                selectElement.appendChild(opt);
            });
        }

        // Helper function to escape special characters for regex
        function escapeRegExp(string) {
          return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        function applyFilters() {
            const searchTerm = searchInput.value.trim();
            const searchTermLower = searchTerm.toLowerCase();
            const selectedGroup = groupFilter.value;
            const selectedClass = classFilter.value;
            const selectedSection = sectionFilter.value;

            // Create a regex for whole-word matching for specific fields
            const escapedTerm = escapeRegExp(searchTerm);
            const searchRegex = new RegExp('\\b' + escapedTerm + '\\b', 'i');

            filteredStaff = allStaff.filter(staff => {
                let matchesSearch = true;
                if (searchTerm) {
                    matchesSearch = 
                        staff.name.toLowerCase().includes(searchTermLower) || // Flexible search for names
                        searchRegex.test(staff.id) ||
                        searchRegex.test(staff.group) ||
                        searchRegex.test(staff.class) ||
                        searchRegex.test(staff.section);
                }
                
                const matchesGroup = !selectedGroup || staff.group === selectedGroup;
                const matchesClass = !selectedClass || staff.class === selectedClass;
                const matchesSection = !selectedSection || staff.section === selectedSection;

                return matchesSearch && matchesGroup && matchesClass && matchesSection;
            });
            
            updateSummaryStats(filteredStaff); // Update stats based on filter
            displayPage(1); // Reset to first page
        }

        function resetAllFilters() {
            searchInput.value = '';
            groupFilter.value = '';
            classFilter.value = '';
            sectionFilter.value = '';
            filteredStaff = [...allStaff];
            updateSummaryStats(filteredStaff); // Update stats on reset
            displayPage(1);
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', fetchData);
        searchInput.addEventListener('input', applyFilters);
        groupFilter.addEventListener('change', applyFilters);
        classFilter.addEventListener('change', applyFilters);
        sectionFilter.addEventListener('change', applyFilters);
        resetButton.addEventListener('click', resetAllFilters);
        refreshButton.addEventListener('click', () => {
            location.reload();
        });
        toggleFiltersBtn.addEventListener('click', () => {
            filtersWrapper.classList.toggle('hidden');
        });
        window.addEventListener('resize', () => {
            updateItemsPerPage();
            // Re-render the current view with the new itemsPerPage value
            displayPage(currentPage); 
        });

        // --- SWIPE GESTURE NAVIGATION FOR MOBILE ---
        let touchStartX = 0;
        let touchEndX = 0;

        function handleSwipeGesture() {
            const totalPages = Math.ceil(filteredStaff.length / itemsPerPage);
            const swipeThreshold = 50; // Minimum pixel distance for a swipe

            if (touchEndX < touchStartX - swipeThreshold) {
                // Swiped left
                if (currentPage < totalPages) {
                    displayPage(currentPage + 1);
                }
            }

            if (touchEndX > touchStartX + swipeThreshold) {
                // Swiped right
                if (currentPage > 1) {
                    displayPage(currentPage - 1);
                }
            }
        }

        staffListContainer.addEventListener('touchstart', (event) => {
            touchStartX = event.changedTouches[0].screenX;
        }, { passive: true });

        staffListContainer.addEventListener('touchend', (event) => {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipeGesture();
        });

    </script>
</body>
</html>

